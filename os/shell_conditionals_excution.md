# shell_conditionals_excution

**作者**

Chrisx

**日期**

2022-01-26

**内容**

shell条件执行

----

[toc]

## 条件测试语法

条件测试语法

| 语法          | 描述                                                                       |
| ------------- | -------------------------------------------------------------------------- |
| test表达式    | 使用test命令进行条件测试，test命令与表达式之间至少一个空格，主要使用方式。 |
| [ 表达式 ]    | 使用[]中括号进行条件测试，中括号边界与表达式之间至少一个空格               |
| \[[ 表达式 ]] | 使用[[]]双中括号进行条件测试，双中括号边界与表达式之间至少一个空格         |
| ((表达式))    | 使用(())双小括号进行条件测试，双小括号边界不需要空格，常用于整数对比       |

符号说明

* (())，用于数值比较，运算
* [[]]，用于条件测试，支持`正则`
* \$(())与$[]，用于整数运算
* $()，用于命令替换，等于``
* ${}，用于变量运算，变量原型
* ()，在子shell中运行
* {}，在当前shell中运行

:warning: ()只影响子shell，{}是当前shell，中边界要有空格，命令结尾要有分号;

## 文件测试表达式

对文件条件测试是否为真

* -d file，文件存在且为目录则为真
* -f file，文件存在且为普通文件则为真
* -e file，文件存在则为真，不辨别文件或目录
* -s file，文件存在且文件大小不为0则为真
* -r file，文件存在且可读则为真，与执行脚本用户权限无关。
* -w file，文件存在且可写则为真，与执行脚本用户权限无关。
* -x file，文件存在且可执行则为真，与执行脚本用户权限无关。
* -L file，文件存在且为链接文件则为真
* f1 -nt f2，文件1比文件2新则为真，根据文件修改时间计算
* f1 -ot f2，文件1比文件2旧则为真，根据文件修改时间计算

示例：

```sh
[ -d $(pwd) ];echo $?
[ -f $(pwd) ];echo $?
```

## 字符串表达式

对字符串条件测试是否为真

* -z s1，字符串s1长度为0则为真
* -n s1，字符串s1长度大于0则为真
* s1 = s2，字符串s1等于s2则为真，“=”前后应有空格，也可使用“==”
* s1 != s2，字符串s1不等于s2则为真
* s1 < s2，按字典顺序，s1在s2之前，则测试条件为真
* s1 > s2，按字典顺序，s1在s2之后，则测试条件为真

示例：

```sh
[ $user = "root" ];echo $?
[ -n $(pwd) ];echo $?
```

## 整数操作符

对整数条件测试

| 在[]和test中使用 | 在[[]]和(())中使用 | 说明                    |
| ---------------- | ------------------ | ----------------------- |
| -eq              | =或==              | 等于，equal             |
| -nq              | !=                 | 不等于，not equal       |
| -gt              | >                  | 大于，greater than      |
| -ge              | >=                 | 大于等于，greater equal |
| -lt              | <                  | 小于，less than         |
| -le              | <=                 | 小于等于，less equal    |

示例

```sh

```

## 逻辑条件判断

| 在[]或test中使用 | 在(())或[[]]中使用 | 说明                          |
| ---------------- | ------------------ | ----------------------------- |
| -a               | &&                 | and,与，两端都为真则为真      |
| -o               | \|\|               | or，或，两端一个为真则为真    |
| !                | !                  | not，非，两端相反，则结果为真 |

```sh
[ 1 -lt 2 -a 5 -gt 10 ];echo $?
[ 1 -lt 2 -o 5 -gt 10 ];echo $?
[[ "$USER" =~ ^r ]];echo $? #使用正则表达式
```

## if

单分支if条件语句

```sh
if [ 条件判断 ];then
    条件成立时执行命令
fi

```

* if使用fi结尾
* [ 条件判断 ]是条件测试，中括号前后有空格
* then在[ 条件判断 ]之后，用分号隔开，也可以换行写，就不需要分号了

示例

```sh
fs=$(df -k | grep sdc | awk '{print $5}' | awk -F '%' '{print $1}')
if [ $fs -gt 80 ];then
    echo "fs full"
fi
```

双分支if语句

```sh
if [ 条件判断 ];then
    条件成立时执行命令
else
    条件不成立时执行命令
fi

```

多分支if语句

```sh
if [ 条件判断1 ];then
    条件成立时执行命令1
elif [ 条件判断2 ];then
    条件成立时执行命令
else
    条件成立时执行命令
fi

```

## case

case与多分支if语句相同。但case只能判断一种语句。

```sh
case 变量 in
值1)
    如果变量等于值1则执行命令1
    ;;
值2)
    如果变量等于值2则执行命令2
    ;;
值3)
    如果变量等于值3则执行命令3
    ;;
*)
    如果变量不等于以上任何值则执行默认命令
esac

```

case示例

ref[color.sh](../lib/sh/color.sh)

