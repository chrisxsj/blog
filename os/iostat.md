# iostat

**作者**

Chrisx

**日期**

2021-05-12

**内容**

在排查分析io问题时，可以使用iostat查看磁盘的IO性能状态数据。

----

[toc]

## 用法

```sh
iostat --help


常用参数

-c: 输出cpu统计信息
-d: 输出磁盘统计信息     注：默认是两个都输出
-k|-m: 以kb/s|mb/s代替原来的块/s
-t: 输出时打印收集信息时刻的时间   注：时间的打印格式和系统变量S_TIME_FORMAT相关
-x: 输出详细的拓展统计数据，比如各种等待时间，队列，利用率等信息。
interval [count] :interval是统计的时间间隔单位是s，count则是统计次数

iostat -tkx 210

输出解释：

rrqm/s:IO设备每秒读取请求有多少被merge。
wrqm/s:IO设备每秒写入请求有多少被merge。

注:当系统调用需要读取数据的时候，VFS将请求发到各个FS，如果FS发现不同的读取请求读取的是相同Block的数据，FS会将这个请求合并merge
r/s:IO设备每秒的发起的读请求次数
w/s:IO设备每秒的写请求次数
rkB/s:每秒读K字节数
wkB/s:每秒写K字节数
avgrq-sz:发送到设备的请求的平均大小,单位是扇区。
avgqu-sz:平均请求队列的长度,队列长度越短越好。也是我们观察磁盘性能的核心指标。 
r_await:每个读请求耗费的平均时间,该时间等于IO设备读操作的时间和在队列中等待的时间。
w_await:每个写请求耗费的平均时间,该时间等于IO设备读操作的时间和在队列中等待的时间。   
await:每个IO请求的处理的平均时间（以毫秒为单位）。
svctm:表示平均每次设备I/O操作的服务时间（以毫秒为单位）。
%util:在统计时间内所有处理IO时间，除以总共统计时间。表示该设备的繁忙程度。例如，如果统计间隔1秒，该设备有0.5秒在处理IO，而0.5秒闲置，则该设备的%util = 0.5/1 = 50%。一般地，如果该参数是100%表示设备已经接近满负荷运行。
```

* 关于avg-cpu：%iowait

值越大，说明cpu等待io约严重

* 关于 await和svctm

可以理解为IO请求的响应时间，包括队列等待时间和服务时间，我们分析IO问题时，如果await大于svctm，await-svctm差值越小，则说明队列时间越短, 反之差值越大，队列时间越长，说明磁盘io有性能问题。

* 关于%util

值越大，说明io月繁忙，一直100%。说明io有性能问题。